listen: 127.0.0.1:4223
server_name: "nats-leaf-01"
monitor_port: 8223
jetstream: enabled
jetstream {
    store_dir = "/var/lib/nats/leaf-data"
    domain = "leaf-01"
}
debug:   false
trace:   false
log_file: "/var/log/nats/nats-leaf-01.log"
logfile_size_limit: 100Mb
logfile_max_num: 10
max_payload: 8MB
write_deadline: 10s
leafnodes {
    tls {
        pinned_certs: ["a2818b4eb95e9e8c7cf26469ed8d1ff0db45737cc54c32932346581cae40ca1c","6d0dc0ed85d9c58efb33839bf8735290a0eb28faf365ba0893418e84f2ce73a2"]
        timeout: 60
    }
    isolate_leafnode_interest: true
    reconnect_delay: 2s
    write_deadline: 30s
    remotes = [
        {
            urls: ["tls://app-user:password123@10.0.0.21:7422"]
            account: "LEAF-DMZ"
            first_info_timeout: 60s
            tls {
                timeout: 60
                handshake_first: true
                insecure: true
            }
        }
    ]
}
accounts {
    SYS: {
        users: [ {user: admin, password: $2a$11$7W021DWTzk8uJreQ5faixeYAu3VtyHU8xHqgtauHndD8SSNwOw4gG} ]
        exports: [
            { stream: "$SYS.SERVER.*.STATSZ" }
            { service: "$SYS.REQ.SERVER.PING.JSZ" }
            { service: "$SYS.REQ.SERVER.PING.LEAFZ" }
        ]
    },
    APP: {
        users: [ {user: app-user, password: $2a$11$ygLKi6.n0RTw0pwTDRkxDOVnz6WfebdmESjPiHqldWTQtlIq3AXMO} ]
        jetstream: enabled
        imports: [
            { stream:  {account: SYS, subject: "$SYS.SERVER.*.STATSZ"}, to: "$SYS.SERVER.leaf-01.STATSZ.*" }
            { service: {account: SYS, subject: "$SYS.REQ.SERVER.PING.JSZ"} }
            { service: {account: SYS, subject: "$SYS.REQ.SERVER.PING.LEAFZ"} }

            { service: { account: "LEAF-DMZ", subject: "$JS.hub.API.CONSUMER.CREATE.enrollments" } }
            { service: { account: "LEAF-DMZ", subject: "$JS.hub.API.CONSUMER.CREATE.enrollments.>" } }
            { stream:  { account: "LEAF-DMZ", subject: "deliver.hub.enrollments.>" } }
            { service: { account: "LEAF-DMZ", subject: "$JS.FC.enrollments.>" } }

            { service: { account: "LEAF-DMZ", subject: "$JS.hub.API.CONSUMER.CREATE.settings" } }
            { service: { account: "LEAF-DMZ", subject: "$JS.hub.API.CONSUMER.CREATE.settings.>" } }
            { stream:  { account: "LEAF-DMZ", subject: "deliver.hub.settings.>" } }
            { service: { account: "LEAF-DMZ", subject: "$JS.FC.settings.>" } }

            { service: { account: "LEAF-DMZ", subject: "rpc.info.leaf-01" } }
            { service: { account: "LEAF-DMZ", subject: "rpc.sync.leaf-01" } }
            { service: { account: "LEAF-DMZ", subject: "rpc.download.leaf-01" } }
        ]

        exports: [
            { stream:  'health.leaf-01.>'},
            { service: 'search.leaf-01', response_type: single, response_threshold: 300s}
            { service: 'query.*', response_type: single, response_threshold: 300s}
            { service: 'details.leaf-01.>', response_type: single, response_threshold: 300s}

            { stream:  'events.failed.leaf-01'}
            { stream:  'events.status.leaf-01'}

            { service: 'process.data.leaf-01.*', response_threshold: 1s}
            { service: 'process.request.leaf-01.*', response_threshold: 300s}
            { service: 'rpc.deploy.leaf-01', response_threshold: 300s}
            { service: 'rpc.sync.leaf-01', response_threshold: 300s}

            { service: "$JS.API.CONSUMER.CREATE.events"}
            { service: "$JS.API.CONSUMER.CREATE.events.>"}
            { stream:  "deliver.leaf-01.events.>"}
            { service: "$JS.FC.events.>"}

            { service: "$JS.API.CONSUMER.CREATE.logs"}
            { service: "$JS.API.CONSUMER.CREATE.logs.>"}
            { service: "$JS.API.CONSUMER.MSG.NEXT.logs.>", response_type: stream, response_threshold: 300s}
            { stream:  "deliver.leaf-01.logs.>"}
            { service: "$JS.FC.logs.>"}

            { service: "$JS.API.CONSUMER.CREATE.analytics"}
            { service: "$JS.API.CONSUMER.CREATE.analytics.>"}
            { stream:  "deliver.leaf-01.analytics.>"}
            { service: "$JS.FC.analytics.>"}

            { service: "$JS.API.CONSUMER.CREATE.media"}
            { service: "$JS.API.CONSUMER.CREATE.media.>"}
            { stream:  "deliver.leaf-01.media.>"}
            { service: "$JS.FC.media.>"}
        ]

        mappings: {
            "config.local.>": "config.leaf-01.>"
        }
    }
    LEAF-DMZ: {
        jetstream: disabled
        exports: [
            { service: "$JS.hub.API.CONSUMER.CREATE.enrollments"},
            { service: "$JS.hub.API.CONSUMER.CREATE.enrollments.>"},
            { stream:  "deliver.hub.enrollments.>"},
            { service: "$JS.FC.enrollments.>"},

            { service: "$JS.hub.API.CONSUMER.CREATE.settings"},
            { service: "$JS.hub.API.CONSUMER.CREATE.settings.>"},
            { stream:  "deliver.hub.settings.>"},
            { service: "$JS.FC.settings.>"},

            { service: "rpc.info.leaf-01" }
            { service: "rpc.sync.leaf-01" }
            { service: "rpc.download.leaf-01" }
        ]
        imports: [
            { stream:  {account: APP, subject: 'health.leaf-01.>' } }
            { service: {account: APP, subject: 'search.leaf-01'} }
            { service: {account: APP, subject: 'query.*'} }
            { service: {account: APP, subject: 'details.leaf-01.>'} }

            { stream:  {account: APP, subject: 'events.failed.leaf-01' } }
            { stream:  {account: APP, subject: 'events.status.leaf-01' } }

            { service: {account: APP, subject: 'process.data.leaf-01.*'} }
            { service: {account: APP, subject: 'process.request.leaf-01.*'} }
            { service: {account: APP, subject: 'rpc.deploy.leaf-01'} }
            { service: {account: APP, subject: 'rpc.sync.leaf-01'} }

            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.events" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.events.>" } }
            { stream:  { account: "APP", subject: "deliver.leaf-01.events.>" } }
            { service: { account: "APP", subject: "$JS.FC.events.>" } }

            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.logs" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.logs.>" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.MSG.NEXT.logs.>" } }
            { stream:  { account: "APP", subject: "deliver.leaf-01.logs.>" } }
            { service: { account: "APP", subject: "$JS.FC.logs.>" } }

            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.analytics" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.analytics.>" } }
            { stream:  { account: "APP", subject: "deliver.leaf-01.analytics.>" } }
            { service: { account: "APP", subject: "$JS.FC.analytics.>" } }

            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.media" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.media.>" } }
            { stream:  { account: "APP", subject: "deliver.leaf-01.media.>" } }
            { service: { account: "APP", subject: "$JS.FC.media.>" } }
        ]
    }
}
system_account: SYS
