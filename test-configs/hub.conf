listen: 127.0.0.1:4222
server_name: "nats-hub"
monitor_port: 8222
jetstream: enabled
jetstream {
    store_dir="/var/lib/nats/hub-data"
    domain=hub
}
debug:   false
trace:   false
log_file: "/var/log/nats/nats-hub.log"
logfile_size_limit: 100Mb
logfile_max_num: 10
disable_sublist_cache: false
max_payload: 8MB
write_deadline: 10s
leafnodes {
    port: 7422
    isolate_leafnode_interest: true
    write_deadline: 30s
    advertise: "10.0.0.21:7422"
    authorization {timeout: 60, user: app-user, password: $2a$11$ygLKi6.n0RTw0pwTDRkxDOVnz6WfebdmESjPiHqldWTQtlIq3AXMO, account: HUB-DMZ}
    tls {
        handshake_first: true
        cert_store: "WindowsLocalMachine"
        cert_match_by: "Subject"
        cert_match: "nats-cert-hub"
        timeout: 60
    }
}
accounts {
    SYS: {
        users: [ {user: admin, password: $2a$11$7W021DWTzk8uJreQ5faixeYAu3VtyHU8xHqgtauHndD8SSNwOw4gG} ]
        exports: [
            { stream: "$SYS.SERVER.*.STATSZ" }
            { service: "$SYS.REQ.SERVER.PING.JSZ" }
            { service: "$SYS.REQ.SERVER.PING.LEAFZ" }
        ]
    },
    APP: {
        jetstream: enabled
        users: [ {user: app-user, password: $2a$11$ygLKi6.n0RTw0pwTDRkxDOVnz6WfebdmESjPiHqldWTQtlIq3AXMO} ]
        exports: [
            { service: "$JS.API.CONSUMER.CREATE.enrollments"}
            { service: "$JS.API.CONSUMER.CREATE.enrollments.>"}
            { stream:  "deliver.hub.enrollments.>"}
            { service: "$JS.FC.enrollments.>"}

            { service: "$JS.API.CONSUMER.CREATE.settings"}
            { service: "$JS.API.CONSUMER.CREATE.settings.>"}
            { stream:  "deliver.hub.settings.>"}
            { service: "$JS.FC.settings.>"}

            { service: "rpc.info.>" }
            { service: "rpc.sync.>" }
            { service: "rpc.download.>" }
        ]
        imports: [
            { stream: {account: SYS, subject: "$SYS.SERVER.*.STATSZ"}, to: "$SYS.SERVER.hub.STATSZ.*"  }
            { service: {account: SYS, subject: "$SYS.REQ.SERVER.PING.JSZ"} }
            { service: {account: SYS, subject: "$SYS.REQ.SERVER.PING.LEAFZ"} }

            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.events" } }
            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.events.>" } }
            { stream:  { account: "HUB-DMZ", subject: "deliver.*.events.>" } }
            { service: { account: "HUB-DMZ", subject: "$JS.FC.events.>" } }

            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.logs" } }
            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.logs.>" } }
            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.MSG.NEXT.logs.>" } }
            { stream:  { account: "HUB-DMZ", subject: "deliver.*.logs.>" } }
            { service: { account: "HUB-DMZ", subject: "$JS.FC.logs.>" } }

            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.analytics" } }
            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.analytics.>" } }
            { stream:  { account: "HUB-DMZ", subject: "deliver.*.analytics.>" } }
            { service: { account: "HUB-DMZ", subject: "$JS.FC.analytics.>" } }

            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.media" } }
            { service: { account: "HUB-DMZ", subject: "$JS.*.API.CONSUMER.CREATE.media.>" } }
            { stream:  { account: "HUB-DMZ", subject: "deliver.*.media.>" } }
            { service: { account: "HUB-DMZ", subject: "$JS.FC.media.>" } }

            { stream: {account: "HUB-DMZ", subject: 'health.*.>'}}
            { service: {account: "HUB-DMZ", subject: 'search.*'}}
            { service: {account: "HUB-DMZ", subject: 'query.*'}}
            { service: {account: "HUB-DMZ", subject: 'details.*.>'}}

            { stream: {account: "HUB-DMZ", subject: 'events.failed.*'}}
            { stream: {account: "HUB-DMZ", subject: 'events.status.*'}}

            { service: {account: HUB-DMZ, subject: 'process.request.*.*'} }
            { service: {account: HUB-DMZ, subject: 'process.data.*.*'} }
            { service: {account: HUB-DMZ, subject: 'rpc.deploy.*'} }
            { service: {account: HUB-DMZ, subject: 'rpc.sync.*'} }
        ]
    },
    HUB-DMZ: {
        jetstream: disabled
        imports: [
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.enrollments" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.enrollments.>" } }
            { stream:  { account: "APP", subject: "deliver.hub.enrollments.>" } }
            { service: { account: "APP", subject: "$JS.FC.enrollments.>" } }

            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.settings" } }
            { service: { account: "APP", subject: "$JS.API.CONSUMER.CREATE.settings.>" } }
            { stream:  { account: "APP", subject: "deliver.hub.settings.>" } }
            { service: { account: "APP", subject: "$JS.FC.settings.>" } }

            { service: { account: "APP", subject: "rpc.info.>" } },
            { service: { account: "APP", subject: "rpc.sync.>" } },
            { service: { account: "APP", subject: "rpc.download.>" } },
        ]
        exports: [
            { service: "$JS.*.API.CONSUMER.CREATE.events"},
            { service: "$JS.*.API.CONSUMER.CREATE.events.>"},
            { stream:  "deliver.*.events.>"},
            { service: "$JS.FC.events.>"},

            { service: "$JS.*.API.CONSUMER.CREATE.logs"},
            { service: "$JS.*.API.CONSUMER.CREATE.logs.>"},
            { service: "$JS.*.API.CONSUMER.MSG.NEXT.logs.>", response_type: stream, response_threshold: 300s},
            { stream:  "deliver.*.logs.>"},
            { service: "$JS.FC.logs.>"},

            { service: "$JS.*.API.CONSUMER.CREATE.analytics"},
            { service: "$JS.*.API.CONSUMER.CREATE.analytics.>"},
            { stream:  "deliver.*.analytics.>"},
            { service: "$JS.FC.analytics.>"},

            { service: "$JS.*.API.CONSUMER.CREATE.media"},
            { service: "$JS.*.API.CONSUMER.CREATE.media.>"},
            { stream:  "deliver.*.media.>"},
            { service: "$JS.FC.media.>"},

            { service: 'search.*',    response_type: single, response_threshold: 300s},
            { service: 'query.*',    response_type: stream, response_threshold: 300s},
            { service: 'details.*.>', response_type: single, response_threshold: 300s},
            { stream:  'health.*.>'},

            { stream:  'events.failed.*'},
            { stream:  'events.status.*'},

            { service: 'process.data.*.*', response_threshold: 1s},
            { service: 'process.request.*.*', response_threshold: 300s},
            { service: 'rpc.deploy.*', response_threshold: 300s},
            { service: 'rpc.sync.*', response_threshold: 300s},
        ]
    },
}
system_account: SYS
